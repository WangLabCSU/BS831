<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classification Using Caret • BS831</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Classification Using Caret">
<meta property="og:description" content="BS831">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">BS831</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.20.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Markdowns
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Introduction to Genomics Analysis</li>
    <li>
      <a href="../../articles/docs/matrixOp.html">Efficient Computation in R</a>
    </li>
    <li>
      <a href="../../articles/docs/ExpressionSet.html">The ExpressionSet Data Object</a>
    </li>
    <li>
      <a href="../../articles/docs/Distributions.html">Probability Distributions</a>
    </li>
    <li>
      <a href="../../articles/docs/Mix_Normals.html">Mixture of Normals</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Preprocessing and Quality Control</li>
    <li>
      <a href="../../articles/docs/Microarray_Processing.html">Data Acquisition and ExpressionSet Basics</a>
    </li>
    <li>
      <a href="../../articles/docs/microarrayQC.html">Quality Control</a>
    </li>
    <li>
      <a href="../../articles/docs/Dimensionality_Reduction.html">Dimensionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/docs/Heatmaps.html">Heatmaps</a>
    </li>
    <li>
      <a href="../../articles/docs/hclust.html">Hierarchical Clustering</a>
    </li>
    <li>
      <a href="../../articles/docs/quantileNormalization.html">Quantile Normalization</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Comparative Experiments I: Microarrays and Linear Models</li>
    <li>
      <a href="../../articles/docs/SampleSize.html">Sample Size and Statistical Significance</a>
    </li>
    <li>
      <a href="../../articles/docs/MHTcorrection.html">Multiple-Hypothesis Correction</a>
    </li>
    <li>
      <a href="../../articles/docs/Linear_Regression.html">Linear Regression</a>
    </li>
    <li>
      <a href="../../articles/docs/diffanalLM.html">Differential Analysis as Linear Regression</a>
    </li>
    <li>
      <a href="../../articles/docs/Diffanalysis.html">Gene Expression Differential Analysis with Microarrays</a>
    </li>
    <li>
      <a href="../../articles/docs/Diffanal_LimmaBC.html">Gene Expression Differential Analysis based on Limma</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Comparative Experiments II: RNA-seq and Generalized Lineary Models</li>
    <li>
      <a href="../../articles/docs/RNAseq_ScalNorm.html">RNA-Seq Data Scaling and Normalization</a>
    </li>
    <li>
      <a href="../../articles/docs/DiffanalysisRNAseqComparison.html">RNA-seq Differential Expression Analysis with DEseq2, edgeR and limma</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Comparative Experiments III: Differential Enrichment Analysis</li>
    <li>
      <a href="../../articles/docs/HyperEnrichment.html">HyperGeometric Enrichment</a>
    </li>
    <li>
      <a href="../../articles/docs/KS_Enrichment.html">KS-based Enrichment</a>
    </li>
    <li>
      <a href="../../articles/docs/GenesetMapping4KS.html">Mapping genesets for KS testing</a>
    </li>
    <li>
      <a href="../../articles/docs/GeneSetProjectionGSVA.html">Gene Set Projection based on KS</a>
    </li>
    <li>
      <a href="../../articles/docs/GeneSetProjectionASSIGN.html">Geneset projection based on ASSIGN</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Classification</li>
    <li>
      <a href="../../articles/docs/featureRedundancy.html">Feature Redundancy: the Good and the Bad</a>
    </li>
    <li>
      <a href="../../articles/docs/Classification_Caret.html">Classification Using Caret</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Clustering</li>
    <li>
      <a href="../../articles/docs/Clustering.html">Clustering and Heatmap Visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/montilab/BS831">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Classification Using Caret</h1>
                        <h4 data-toc-skip class="author">Stefano
Monti</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/montilab/BS831/blob/HEAD/vignettes/docs/Classification_Caret.Rmd"><code>vignettes/docs/Classification_Caret.Rmd</code></a></small>
      <div class="hidden name"><code>Classification_Caret.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/montilab/BS831">BS831</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biobase" class="external-link">Biobase</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://expasy.org/tools/pROC/" class="external-link">pROC</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="loading-the-drugmatrix-data">Loading the DrugMatrix Data<a class="anchor" aria-label="anchor" href="#loading-the-drugmatrix-data"></a>
</h2>
<p>Loading data for the classification task. We will be using the
10-chemical subset of the DrugMatrix dataset, and aim to predict the
chemicals’ carcinogenicity status.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## DrugMatrix dataset comprising 10 drugs plus controls</span></span>
<span><span class="va">DM</span> <span class="op">&lt;-</span> <span class="va">dm10</span></span>
<span><span class="co">## show chemicals and their numbers</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">[</span>,<span class="st">"CHEMICAL"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##                                     2,3,7,8-TETRACHLORODIBENZO-P-DIOXIN </span></span>
<span><span class="co">##                                 225                                   9 </span></span>
<span><span class="co">##                       ACETAMINOPHEN                             ASPIRIN </span></span>
<span><span class="co">##                                   3                                  24 </span></span>
<span><span class="co">##                            DIAZEPAM                         DOXORUBICIN </span></span>
<span><span class="co">##                                   8                                  21 </span></span>
<span><span class="co">##                           IBUPROFEN                          LOVASTATIN </span></span>
<span><span class="co">##                                   9                                  18 </span></span>
<span><span class="co">##                       ROSIGLITAZONE                           TAMOXIFEN </span></span>
<span><span class="co">##                                   6                                   9 </span></span>
<span><span class="co">##                        TESTOSTERONE </span></span>
<span><span class="co">##                                   6</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## show carcinogenicity status</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Carcinogen_liv"</span><span class="op">]</span>,exclude<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##   NON-CARC CARCINOGEN       &lt;NA&gt; </span></span>
<span><span class="co">##         63         50        225</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## exclude the controls (the ones with carcinogenicity status==NA)</span></span>
<span><span class="va">DM1</span> <span class="op">&lt;-</span> <span class="va">DM</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Carcinogen_liv"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">DM1</span><span class="op">$</span><span class="va">Carcinogen_liv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">DM1</span><span class="op">$</span><span class="va">Carcinogen_liv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM1</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Carcinogen_liv"</span><span class="op">]</span>,exclude<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##   NON-CARC CARCINOGEN </span></span>
<span><span class="co">##         63         50</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## carry out (drastic) variation filtering</span></span>
<span><span class="va">DM1000</span> <span class="op">&lt;-</span> <span class="fu">variationFilter</span><span class="op">(</span><span class="va">DM1</span>,ngenes<span class="op">=</span><span class="fl">1000</span>,score<span class="op">=</span><span class="st">"mad"</span>,do.plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Variation filtering based on mad .. done.</span></span>
<span><span class="co">## Selecting top 1000 by mad .. done, 1000 genes selected.</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Features  Samples </span></span>
<span><span class="co">##     1000      113</span></span></code></pre>
<div class="section level3">
<h3 id="exploratory-data-visualization">Exploratory Data Visualization<a class="anchor" aria-label="anchor" href="#exploratory-data-visualization"></a>
</h3>
<p>After having uploaded and properly processed the data, we start by
visualizing them with a heatmap (see
<code>Rmodule_heatmap.Rmd</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap" class="external-link">ComplexHeatmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize" class="external-link">circlize</a></span><span class="op">)</span></span>
<span><span class="va">DMscaled</span> <span class="op">&lt;-</span> <span class="fu">scale_row</span><span class="op">(</span><span class="va">DM1000</span><span class="op">)</span></span>
<span><span class="va">hm.annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html" class="external-link">HeatmapAnnotation</a></span><span class="op">(</span></span>
<span>    CARCINOGEN<span class="op">=</span><span class="va">DMscaled</span><span class="op">$</span><span class="va">Carcinogen_liv</span>,</span>
<span>    GTOX<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">DMscaled</span><span class="op">$</span><span class="va">GenTox</span><span class="op">)</span>,</span>
<span>    na_col<span class="op">=</span><span class="st">"ghostwhite"</span>,</span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>CARCINOGEN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NON-CARC"</span><span class="op">=</span><span class="st">"green"</span>,CARCINOGEN<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>             GTOX<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'0'</span><span class="op">=</span><span class="st">"orange"</span>,<span class="st">'1'</span><span class="op">=</span><span class="st">"purple"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">Heatmap</a></span><span class="op">(</span><span class="fu">Biobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">DMscaled</span><span class="op">)</span>,</span>
<span>        name<span class="op">=</span><span class="st">"expression"</span>, </span>
<span>        col<span class="op">=</span><span class="fu">circlize</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#072448"</span>, <span class="st">"white"</span>, <span class="st">"#ff6150"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        top_annotation<span class="op">=</span><span class="va">hm.annotation</span>, </span>
<span>        cluster_rows<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        cluster_columns<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        clustering_distance_rows<span class="op">=</span><span class="st">"euclidean"</span>,</span>
<span>        clustering_method_rows<span class="op">=</span><span class="st">"ward.D"</span>,    </span>
<span>        clustering_distance_columns<span class="op">=</span><span class="st">"euclidean"</span>,</span>
<span>        clustering_method_columns<span class="op">=</span><span class="st">"ward.D"</span>, </span>
<span>        column_split<span class="op">=</span><span class="fl">6</span>,</span>
<span>        show_parent_dend_line<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        row_title<span class="op">=</span><span class="st">""</span>,</span>
<span>        show_column_names<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>        show_row_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Classification_Caret_files/figure-html/complex.heatmap-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="classifying-the-carcinogenicity-status-of-compounds">Classifying the Carcinogenicity Status of Compounds<a class="anchor" aria-label="anchor" href="#classifying-the-carcinogenicity-status-of-compounds"></a>
</h2>
<div class="section level3">
<h3 id="data-partitioning">Data partitioning<a class="anchor" aria-label="anchor" href="#data-partitioning"></a>
</h3>
<p>Here, we perform the data partition into discovery and validation
sets (alternatively, into train and test sets).</p>
<p>We start by simplifying the phenotype labels.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3456</span><span class="op">)</span> <span class="co"># for reproducible results</span></span>
<span></span>
<span><span class="co">## some renaming to make data handling simpler</span></span>
<span><span class="va">DM1000</span><span class="op">$</span><span class="va">CHEMICAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">$</span><span class="va">CHEMICAL</span><span class="op">)</span>              <span class="co"># ensuring phenoype is a factor</span></span>
<span><span class="va">DM1000</span><span class="op">$</span><span class="va">Carcinogen_liv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">$</span><span class="va">Carcinogen_liv</span><span class="op">)</span>  <span class="co"># ditto</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">$</span><span class="va">Carcinogen_liv</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">$</span><span class="va">Carcinogen_liv</span><span class="op">)</span><span class="op">==</span><span class="st">"NON-CARC"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"noncarc"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">$</span><span class="va">Carcinogen_liv</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">$</span><span class="va">Carcinogen_liv</span><span class="op">)</span><span class="op">==</span><span class="st">"CARCINOGEN"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"carc"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"CHEMICAL"</span>, <span class="st">"Carcinogen_liv"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co"># show composition</span></span></code></pre></div>
<pre><code><span><span class="co">##                                      Carcinogen_liv</span></span>
<span><span class="co">## CHEMICAL                              noncarc carc</span></span>
<span><span class="co">##   2,3,7,8-TETRACHLORODIBENZO-P-DIOXIN       0    9</span></span>
<span><span class="co">##   ACETAMINOPHEN                             3    0</span></span>
<span><span class="co">##   ASPIRIN                                  24    0</span></span>
<span><span class="co">##   DIAZEPAM                                  0    8</span></span>
<span><span class="co">##   DOXORUBICIN                              21    0</span></span>
<span><span class="co">##   IBUPROFEN                                 9    0</span></span>
<span><span class="co">##   LOVASTATIN                                0   18</span></span>
<span><span class="co">##   ROSIGLITAZONE                             6    0</span></span>
<span><span class="co">##   TAMOXIFEN                                 0    9</span></span>
<span><span class="co">##   TESTOSTERONE                              0    6</span></span></code></pre>
<p>We then perform the <em>stratified</em> partition, whereby stratified
means that both subsets should have a relatively equal representation of
the two classes (‘noncar’ and ‘carc’).</p>
<p>Also, notice that there is an additional level of complexity here,
because we have multiple replicates for each chemical. Hence, if we were
to carry out the split ‘naively’, we might end up with representative of
the same chemicals <em>both</em> in the discovery and validation set,
which would not be appropriate (it would be ‘cheating’).</p>
<p>To address this issue, we carry out the partition at the
<em>chemical</em> level, rather than the <em>sample</em> level. That is,
we partition the chemicals into a discovery and validation set, so that
<em>all</em> the replicates of a given chemical will be assigned to
either the discovery or the validation set.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## data partitioning into discovery and validation set</span></span>
<span><span class="va">CHEMICALGROUP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">DM1000</span><span class="op">)</span><span class="op">$</span><span class="va">CHEMICAL</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHEMICAL"</span>, <span class="st">"Carcinogen_liv"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">discoveryCHEMICALindex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span><span class="va">CHEMICALGROUP</span><span class="op">$</span><span class="va">Carcinogen_liv</span>, p<span class="op">=</span><span class="fl">0.6</span>, list<span class="op">=</span><span class="cn">FALSE</span>, times<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">discoveryCHEMICAL</span> <span class="op">&lt;-</span> <span class="va">CHEMICALGROUP</span><span class="op">$</span><span class="va">CHEMICAL</span><span class="op">[</span><span class="va">discoveryCHEMICALindex</span><span class="op">]</span></span>
<span><span class="va">validationCHEMICAL</span> <span class="op">&lt;-</span> <span class="va">CHEMICALGROUP</span><span class="op">$</span><span class="va">CHEMICAL</span><span class="op">[</span><span class="op">-</span><span class="va">discoveryCHEMICALindex</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## split data into discovery and validation set (all replicates belong to one or the other)</span></span>
<span><span class="va">DM1000discovery</span> <span class="op">&lt;-</span> <span class="va">DM1000</span><span class="op">[</span>,<span class="va">DM1000</span><span class="op">$</span><span class="va">CHEMICAL</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">discoveryCHEMICAL</span><span class="op">]</span></span>
<span><span class="va">DM1000validation</span> <span class="op">&lt;-</span> <span class="va">DM1000</span><span class="op">[</span>,<span class="va">DM1000</span><span class="op">$</span><span class="va">CHEMICAL</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">validationCHEMICAL</span><span class="op">]</span></span>
<span></span>
<span><span class="va">discovery</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">Biobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">DM1000discovery</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">discoveryLab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">DM1000discovery</span><span class="op">$</span><span class="va">Carcinogen_liv</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"noncarc"</span>, <span class="st">"carc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">Biobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">DM1000validation</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">validationLab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">DM1000validation</span><span class="op">$</span><span class="va">Carcinogen_liv</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"noncarc"</span>, <span class="st">"carc"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fitting-on-the-training-set">Model Fitting on the Training Set<a class="anchor" aria-label="anchor" href="#model-fitting-on-the-training-set"></a>
</h3>
<p>We now fit a KNN classifier. We evaluate several versions, based on
different numbers of neighbors, and evaluate the performance of each by
5-fold cross-validation (cv).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## KNN with 5x cross validation</span></span>
<span><span class="va">fitControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,</span>
<span>                           number<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           classProbs<span class="op">=</span><span class="cn">T</span>,</span>
<span>                           summaryFunction<span class="op">=</span><span class="va">twoClassSummary</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># for reproducible results</span></span>
<span></span>
<span><span class="co">## evaluate on train set based on area under the ROC (AUC)</span></span>
<span><span class="va">KNN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">discovery</span>,</span>
<span>             y<span class="op">=</span><span class="va">discoveryLab</span>,</span>
<span>             method<span class="op">=</span><span class="st">"knn"</span>,</span>
<span>             trControl<span class="op">=</span><span class="va">fitControl</span>,</span>
<span>             tuneGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>.k<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">9</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             metric<span class="op">=</span><span class="st">'ROC'</span><span class="op">)</span></span>
<span><span class="co">## summary of performance across each value of tuning parameters</span></span>
<span><span class="va">KNN</span></span></code></pre></div>
<pre><code><span><span class="co">## k-Nearest Neighbors </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   63 samples</span></span>
<span><span class="co">## 1000 predictors</span></span>
<span><span class="co">##    2 classes: 'noncarc', 'carc' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 51, 51, 50, 50, 50 </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   k   ROC        Sens       Spec</span></span>
<span><span class="co">##    3  0.9521429  0.9714286  0.92</span></span>
<span><span class="co">##    5  0.9717857  0.9464286  0.96</span></span>
<span><span class="co">##    7  0.9797321  0.9464286  1.00</span></span>
<span><span class="co">##    9  0.9750000  0.9464286  0.88</span></span>
<span><span class="co">##   20  0.8258929  0.7964286  0.47</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ROC was used to select the optimal model using the largest value.</span></span>
<span><span class="co">## The final value used for the model was k = 7.</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">KNN</span>, metric <span class="op">=</span> <span class="st">"ROC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Classification_Caret_files/figure-html/classify_3-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## show the parameters that yield the most accurate classifier (as estimated by cv)</span></span>
<span><span class="va">KNN</span><span class="op">$</span><span class="va">bestTune</span></span></code></pre></div>
<pre><code><span><span class="co">##   k</span></span>
<span><span class="co">## 3 7</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#final model used and performance across test sets of each fold</span></span>
<span><span class="va">KNN</span><span class="op">$</span><span class="va">finalModel</span></span></code></pre></div>
<pre><code><span><span class="co">## 7-nearest neighbor model</span></span>
<span><span class="co">## Training set outcome distribution:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## noncarc    carc </span></span>
<span><span class="co">##      39      24</span></span></code></pre>
<p><strong>WARNING</strong>: It should be noted that the internal cv
performed by caret in this case does not take into account the problem
of multiple replicates per chemical. Thus the cv estimates of accuracy
(based on AUC) will in general be over-optimistic. However, we will hope
that all the estimates will be equally over-optimistic, thus allowing us
to select the best model parameterization.</p>
</div>
<div class="section level3">
<h3 id="validation-on-the-test-set">Validation on the Test Set<a class="anchor" aria-label="anchor" href="#validation-on-the-test-set"></a>
</h3>
<p>After having selected the “best” classifier, we can now apply it to
the validation set.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predicting the validation data:</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">KNN</span>,<span class="va">validation</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## or predicting using the probabilities (nice because you can get ROC)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/predict.train.html" class="external-link">extractProb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">KNN</span><span class="op">)</span>,</span>
<span>                     testX<span class="op">=</span><span class="va">validation</span>,</span>
<span>                     testY<span class="op">=</span><span class="va">validationLab</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## removing trainings data</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">probs</span><span class="op">[</span><span class="va">probs</span><span class="op">$</span><span class="va">dataType</span><span class="op">!=</span><span class="st">'Training'</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">## Make sure the levels are appropriate for twoClassSummary(), ie case group is first level</span></span>
<span><span class="va">levs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carc"</span>, <span class="st">"noncarc"</span><span class="op">)</span></span>
<span><span class="va">probs</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probs</span><span class="op">$</span><span class="va">obs</span>, levels <span class="op">=</span> <span class="va">levs</span><span class="op">)</span></span>
<span><span class="va">probs</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probs</span><span class="op">$</span><span class="va">pred</span>, levels <span class="op">=</span> <span class="va">levs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Calculating Accuracy</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">probs</span><span class="op">$</span><span class="va">obs</span><span class="op">==</span><span class="va">probs</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.48</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## see classification prob for each sample in validation set</span></span>
<span><span class="co">## pred column shows model predicted label if cutoff for calling label = 0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">probs</span><span class="op">$</span><span class="va">obs</span>, <span class="va">probs</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          </span></span>
<span><span class="co">##           carc noncarc</span></span>
<span><span class="co">##   carc       3      23</span></span>
<span><span class="co">##   noncarc    3      21</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## summary of performance result on validation set</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">twoClassSummary</a></span><span class="op">(</span><span class="va">probs</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">probs</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       ROC      Sens      Spec </span></span>
<span><span class="co">## 0.3421474 0.1153846 0.8750000</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="random-forest">Random Forest<a class="anchor" aria-label="anchor" href="#random-forest"></a>
</h3>
<div class="section level4">
<h4 id="model-fitting-on-the-training-set-1">Model Fitting on the Training Set<a class="anchor" aria-label="anchor" href="#model-fitting-on-the-training-set-1"></a>
</h4>
<p>Next we fit a Random Forest classifier. We evaluate several versions,
based on different numbers of random features to be used for each tree,
and evaluate the performance of each by 5-fold cross-validation (cv).
Note, that a commonly features per tree is <span class="math inline">\(\sqrt{total\; features}\)</span>, in this case
<span class="math inline">\(\sqrt{total\; features} = \sqrt{1000} \sim
32\)</span>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## RandomForest with 5x cross validation</span></span>
<span><span class="va">fitControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,</span>
<span>                           number<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           classProbs<span class="op">=</span><span class="cn">T</span>,</span>
<span>                           summaryFunction<span class="op">=</span><span class="va">twoClassSummary</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># for reproducible results</span></span>
<span></span>
<span><span class="co">## evaluate on train set based on area under the ROC (AUC)</span></span>
<span><span class="va">RF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">discovery</span>,</span>
<span>             y<span class="op">=</span><span class="va">discoveryLab</span>,</span>
<span>             method<span class="op">=</span><span class="st">"rf"</span>,</span>
<span>             trControl<span class="op">=</span><span class="va">fitControl</span>,</span>
<span>             tuneGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>mtry<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             metric<span class="op">=</span><span class="st">'ROC'</span><span class="op">)</span></span>
<span><span class="co">## summary of performance across each value of tuning parameters</span></span>
<span><span class="va">RF</span></span></code></pre></div>
<pre><code><span><span class="co">## Random Forest </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   63 samples</span></span>
<span><span class="co">## 1000 predictors</span></span>
<span><span class="co">##    2 classes: 'noncarc', 'carc' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 51, 51, 50, 50, 50 </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   mtry  ROC        Sens       Spec</span></span>
<span><span class="co">##    32   0.9735714  0.9714286  0.88</span></span>
<span><span class="co">##    50   0.9785714  0.9714286  0.88</span></span>
<span><span class="co">##   100   0.9703571  0.9714286  0.88</span></span>
<span><span class="co">##   250   0.9392857  0.9464286  0.84</span></span>
<span><span class="co">##   500   0.9400000  0.9214286  0.84</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ROC was used to select the optimal model using the largest value.</span></span>
<span><span class="co">## The final value used for the model was mtry = 50.</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">RF</span>, metric <span class="op">=</span> <span class="st">"ROC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Classification_Caret_files/figure-html/classify_5-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## show the parameters that yield the most accurate classifier (as estimated by cv)</span></span>
<span><span class="va">RF</span><span class="op">$</span><span class="va">bestTune</span></span></code></pre></div>
<pre><code><span><span class="co">##   mtry</span></span>
<span><span class="co">## 2   50</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#final model used and performance across test sets of each fold</span></span>
<span><span class="va">RF</span><span class="op">$</span><span class="va">finalModel</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##  randomForest(x = x, y = y, mtry = param$mtry) </span></span>
<span><span class="co">##                Type of random forest: classification</span></span>
<span><span class="co">##                      Number of trees: 500</span></span>
<span><span class="co">## No. of variables tried at each split: 50</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##         OOB estimate of  error rate: 6.35%</span></span>
<span><span class="co">## Confusion matrix:</span></span>
<span><span class="co">##         noncarc carc class.error</span></span>
<span><span class="co">## noncarc      38    1  0.02564103</span></span>
<span><span class="co">## carc          3   21  0.12500000</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="validation-on-the-test-set-1">Validation on the Test Set<a class="anchor" aria-label="anchor" href="#validation-on-the-test-set-1"></a>
</h4>
<p>All of the classifiers work well on the training data. A nice thing
about Random Forests are that they’re performance is fairly robust to
different parameter choices We’ll end using use <span class="math inline">\(\sqrt{total\; features} = \sqrt{1000} \sim
32\)</span> , we can now apply it to the validation set.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predicting the validation data:</span></span>
<span><span class="va">predRF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">RF</span>,<span class="va">validation</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## or predicting using the probabilities (nice because you can get ROC)</span></span>
<span><span class="va">probsRF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/predict.train.html" class="external-link">extractProb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">RF</span><span class="op">)</span>,</span>
<span>                     testX<span class="op">=</span><span class="va">validation</span>,</span>
<span>                     testY<span class="op">=</span><span class="va">validationLab</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## removing trainings data</span></span>
<span><span class="va">probsRF</span> <span class="op">&lt;-</span> <span class="va">probsRF</span><span class="op">[</span><span class="va">probsRF</span><span class="op">$</span><span class="va">dataType</span><span class="op">!=</span><span class="st">'Training'</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">## Make sure the levels are appropriate for twoClassSummary(), ie case group is first level</span></span>
<span><span class="va">levs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carc"</span>, <span class="st">"noncarc"</span><span class="op">)</span></span>
<span><span class="va">probsRF</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probsRF</span><span class="op">$</span><span class="va">obs</span>, levels <span class="op">=</span> <span class="va">levs</span><span class="op">)</span></span>
<span><span class="va">probsRF</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probsRF</span><span class="op">$</span><span class="va">pred</span>, levels <span class="op">=</span> <span class="va">levs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Calculating Accuracy</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">probsRF</span><span class="op">$</span><span class="va">obs</span><span class="op">==</span><span class="va">probsRF</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## see classification prob for each sample in validation set</span></span>
<span><span class="co">## pred column shows model predicted label if cutoff for calling label = 0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">probsRF</span><span class="op">$</span><span class="va">obs</span>, <span class="va">probsRF</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          </span></span>
<span><span class="co">##           carc noncarc</span></span>
<span><span class="co">##   carc       0      26</span></span>
<span><span class="co">##   noncarc    4      20</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## summary of performance result on validation set</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">twoClassSummary</a></span><span class="op">(</span><span class="va">probsRF</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">probsRF</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       ROC      Sens      Spec </span></span>
<span><span class="co">## 0.1762821 0.0000000 0.8333333</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="support-vecor-machine-linear-kernel">Support Vecor Machine (Linear Kernel)<a class="anchor" aria-label="anchor" href="#support-vecor-machine-linear-kernel"></a>
</h3>
<div class="section level4">
<h4 id="model-fitting-on-the-training-set-2">Model Fitting on the Training Set<a class="anchor" aria-label="anchor" href="#model-fitting-on-the-training-set-2"></a>
</h4>
<p>Next we fit a SVM classifier with a linear. We evaluate several
versions, based on different cost parameters, and evaluate the
performance of each by 5-fold cross-validation (cv). SVM attempts to
separate each group by a hyperplane over all variables by maximizing the
distance (or margin) between this hyperplane and the closest points to
it. The cost parameter controls the leniency of certain points falling
on the wrong side of this hyperplane if it means the margin of the
hyperplane to other points to be greater. This is to control
overfitting. Large cost parameters don’t allow for any points in the
training data to be misclassified.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## SVM with 5x cross validation</span></span>
<span><span class="va">fitControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,</span>
<span>                           number<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           classProbs<span class="op">=</span><span class="cn">T</span>,</span>
<span>                           summaryFunction<span class="op">=</span><span class="va">twoClassSummary</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># for reproducible results</span></span>
<span></span>
<span><span class="co">## evaluate on train set based on area under the ROC (AUC)</span></span>
<span><span class="va">SVM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">discovery</span>,</span>
<span>             y<span class="op">=</span><span class="va">discoveryLab</span>,</span>
<span>             method<span class="op">=</span><span class="st">"svmLinear2"</span>,</span>
<span>             trControl<span class="op">=</span><span class="va">fitControl</span>,</span>
<span>             tuneGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>cost<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4.5</span>, <span class="op">-</span><span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             metric<span class="op">=</span><span class="st">'ROC'</span><span class="op">)</span></span>
<span><span class="co">## summary of performance across each value of tuning parameters</span></span>
<span><span class="va">SVM</span></span></code></pre></div>
<pre><code><span><span class="co">## Support Vector Machines with Linear Kernel </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   63 samples</span></span>
<span><span class="co">## 1000 predictors</span></span>
<span><span class="co">##    2 classes: 'noncarc', 'carc' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 51, 51, 50, 50, 50 </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   cost          ROC        Sens       Spec</span></span>
<span><span class="co">##   3.162278e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   3.548134e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   3.981072e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   4.466836e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   5.011872e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   5.623413e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   6.309573e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   7.079458e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   7.943282e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   8.912509e-05  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.000000e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.122018e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.258925e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.412538e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.584893e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.778279e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   1.995262e-04  0.9621429  1.0000000  0.00</span></span>
<span><span class="co">##   2.238721e-04  0.7621429  1.0000000  0.10</span></span>
<span><span class="co">##   2.511886e-04  0.9621429  1.0000000  0.15</span></span>
<span><span class="co">##   2.818383e-04  0.9621429  1.0000000  0.19</span></span>
<span><span class="co">##   3.162278e-04  0.9621429  1.0000000  0.36</span></span>
<span><span class="co">##   3.548134e-04  0.9621429  0.9214286  0.60</span></span>
<span><span class="co">##   3.981072e-04  0.9621429  0.9214286  0.84</span></span>
<span><span class="co">##   4.466836e-04  0.9621429  0.9464286  0.88</span></span>
<span><span class="co">##   5.011872e-04  0.9621429  0.9714286  0.88</span></span>
<span><span class="co">##   5.623413e-04  0.9621429  0.9714286  0.88</span></span>
<span><span class="co">##   6.309573e-04  0.9678571  0.9714286  0.88</span></span>
<span><span class="co">##   7.079458e-04  0.9678571  0.9714286  0.88</span></span>
<span><span class="co">##   7.943282e-04  0.9678571  0.9714286  0.92</span></span>
<span><span class="co">##   8.912509e-04  0.9678571  0.9714286  0.92</span></span>
<span><span class="co">##   1.000000e-03  0.9785714  0.9714286  0.92</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ROC was used to select the optimal model using the largest value.</span></span>
<span><span class="co">## The final value used for the model was cost = 0.001.</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SVM</span>, metric <span class="op">=</span> <span class="st">"ROC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Classification_Caret_files/figure-html/classify_7-1.png" width="700"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## show the parameters that yield the most accurate classifier (as estimated by cv)</span></span>
<span><span class="va">SVM</span><span class="op">$</span><span class="va">bestTune</span></span></code></pre></div>
<pre><code><span><span class="co">##     cost</span></span>
<span><span class="co">## 31 0.001</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#final model used and performance across test sets of each fold</span></span>
<span><span class="va">SVM</span><span class="op">$</span><span class="va">finalModel</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## svm.default(x = as.matrix(x), y = y, kernel = "linear", cost = param$cost, </span></span>
<span><span class="co">##     probability = classProbs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameters:</span></span>
<span><span class="co">##    SVM-Type:  C-classification </span></span>
<span><span class="co">##  SVM-Kernel:  linear </span></span>
<span><span class="co">##        cost:  0.001 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Support Vectors:  48</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="validation-on-the-test-set-2">Validation on the Test Set<a class="anchor" aria-label="anchor" href="#validation-on-the-test-set-2"></a>
</h4>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predicting the validation data:</span></span>
<span><span class="va">predSVM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">SVM</span>,<span class="va">validation</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## or predicting using the probabilities (nice because you can get ROC)</span></span>
<span><span class="va">probsSVM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/predict.train.html" class="external-link">extractProb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">SVM</span><span class="op">)</span>,</span>
<span>                     testX<span class="op">=</span><span class="va">validation</span>,</span>
<span>                     testY<span class="op">=</span><span class="va">validationLab</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## removing trainings data</span></span>
<span><span class="va">probsSVM</span> <span class="op">&lt;-</span> <span class="va">probsSVM</span><span class="op">[</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">dataType</span><span class="op">!=</span><span class="st">'Training'</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">## Make sure the levels are appropriate for twoClassSummary(), ie case group is first level</span></span>
<span><span class="va">levs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carc"</span>, <span class="st">"noncarc"</span><span class="op">)</span></span>
<span><span class="va">probsSVM</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">obs</span>, levels <span class="op">=</span> <span class="va">levs</span><span class="op">)</span></span>
<span><span class="va">probsSVM</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">pred</span>, levels <span class="op">=</span> <span class="va">levs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Calculating Accuracy</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">obs</span><span class="op">==</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.36</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## see classification prob for each sample in validation set</span></span>
<span><span class="co">## pred column shows model predicted label if cutoff for calling label = 0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">obs</span>, <span class="va">probsSVM</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          </span></span>
<span><span class="co">##           carc noncarc</span></span>
<span><span class="co">##   carc       6      20</span></span>
<span><span class="co">##   noncarc   12      12</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## summary of performance result on validation set</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">twoClassSummary</a></span><span class="op">(</span><span class="va">probsSVM</span>, lev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">probsSVM</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       ROC      Sens      Spec </span></span>
<span><span class="co">## 0.1858974 0.2307692 0.5000000</span></span></code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/tetomonti" class="external-link">Stefano Monti</a>, <a href="https://github.com/anfederico" class="external-link">Anthony Federico</a>, <a href="https://github.com/ericreed" class="external-link">Eric Reed</a>, <a href="https://github.com/lia978" class="external-link">Amy Li</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
