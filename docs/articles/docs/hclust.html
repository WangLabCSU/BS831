<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hierarchical Clustering â€¢ BS831</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Hierarchical Clustering">
<meta property="og:description" content="BS831">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">BS831</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.20.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Markdowns
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Introduction to Genomics Analysis</li>
    <li>
      <a href="../../articles/docs/matrixOp.html">Efficient Computation in R</a>
    </li>
    <li>
      <a href="../../articles/docs/ExpressionSet.html">The ExpressionSet Data Object</a>
    </li>
    <li>
      <a href="../../articles/docs/Distributions.html">Probability Distributions</a>
    </li>
    <li>
      <a href="../../articles/docs/Mix_Normals.html">Mixture of Normals</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Preprocessing and Quality Control</li>
    <li>
      <a href="../../articles/docs/Microarray_Processing.html">Data Acquisition and ExpressionSet Basics</a>
    </li>
    <li>
      <a href="../../articles/docs/microarrayQC.html">Quality Control</a>
    </li>
    <li>
      <a href="../../articles/docs/Dimensionality_Reduction.html">Dimensionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/docs/Heatmaps.html">Heatmaps</a>
    </li>
    <li>
      <a href="../../articles/docs/hclust.html">Hierarchical Clustering</a>
    </li>
    <li>
      <a href="../../articles/docs/quantileNormalization.html">Quantile Normalization</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Comparative Experiments I: Microarrays and Linear Models</li>
    <li>
      <a href="../../articles/docs/SampleSize.html">Sample Size and Statistical Significance</a>
    </li>
    <li>
      <a href="../../articles/docs/MHTcorrection.html">Multiple-Hypothesis Correction</a>
    </li>
    <li>
      <a href="../../articles/docs/Linear_Regression.html">Linear Regression</a>
    </li>
    <li>
      <a href="../../articles/docs/diffanalLM.html">Differential Analysis as Linear Regression</a>
    </li>
    <li>
      <a href="../../articles/docs/Diffanalysis.html">Gene Expression Differential Analysis with Microarrays</a>
    </li>
    <li>
      <a href="../../articles/docs/Diffanal_LimmaBC.html">Gene Expression Differential Analysis based on Limma</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Comparative Experiments II: RNA-seq and Generalized Lineary Models</li>
    <li>
      <a href="../../articles/docs/RNAseq_ScalNorm.html">RNA-Seq Data Scaling and Normalization</a>
    </li>
    <li>
      <a href="../../articles/docs/DiffanalysisRNAseqComparison.html">RNA-seq Differential Expression Analysis with DEseq2, edgeR and limma</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Comparative Experiments III: Differential Enrichment Analysis</li>
    <li>
      <a href="../../articles/docs/HyperEnrichment.html">HyperGeometric Enrichment</a>
    </li>
    <li>
      <a href="../../articles/docs/KS_Enrichment.html">KS-based Enrichment</a>
    </li>
    <li>
      <a href="../../articles/docs/GenesetMapping4KS.html">Mapping genesets for KS testing</a>
    </li>
    <li>
      <a href="../../articles/docs/GeneSetProjectionGSVA.html">Gene Set Projection based on KS</a>
    </li>
    <li>
      <a href="../../articles/docs/GeneSetProjectionASSIGN.html">Geneset projection based on ASSIGN</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Classification</li>
    <li>
      <a href="../../articles/docs/featureRedundancy.html">Feature Redundancy: the Good and the Bad</a>
    </li>
    <li>
      <a href="../../articles/docs/Classification_Caret.html">Classification Using Caret</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Clustering</li>
    <li>
      <a href="../../articles/docs/Clustering.html">Clustering and Heatmap Visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/montilab/BS831">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hierarchical Clustering</h1>
                        <h4 data-toc-skip class="author">Stefano Monti</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/montilab/BS831/blob/HEAD/vignettes/docs/hclust.Rmd"><code>vignettes/docs/hclust.Rmd</code></a></small>
      <div class="hidden name"><code>hclust.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/montilab/BS831">BS831</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pheatmap</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="clustering-of-real-data-the-drug-matrix">Clustering of Real Data: the Drug Matrix<a class="anchor" aria-label="anchor" href="#clustering-of-real-data-the-drug-matrix"></a>
</h2>
<p>We will use the DrugMatrix subset previously described for our examples. This data corresponds to chemical perturbation experiments, whereby rats are exposed to different chemicals, and their liver's RNA is profiled.</p>
<p>We upload the data and perform a drastic variation filtering to obtain a small and easy to manage dataset.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span>

<span class="va">DM</span> <span class="op">&lt;-</span> <span class="fu">variationFilter</span><span class="op">(</span><span class="va">dm10</span>,ngenes<span class="op">=</span><span class="fl">1000</span>,do.plot<span class="op">=</span><span class="cn">TRUE</span>,verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/drugMatrix-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="hierarchical-clustering">Hierarchical Clustering<a class="anchor" aria-label="anchor" href="#hierarchical-clustering"></a>
</h2>
<p>Let us analyze the data by carrying out hierarchical clustering. We'll use <code>heatmap.plus</code> to visualize the data. Let us first define a simple function to create a color gradient to be used for coloring the gene expression heatmaps.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colGradient</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">cols</span>, <span class="va">length</span>, <span class="va">cmax</span><span class="op">=</span><span class="fl">255</span> <span class="op">)</span>
<span class="op">{</span>
  <span class="co">## e.g., to create a white-to-red gradient with 10 levels</span>
  <span class="co">##</span>
  <span class="co">##   colGradient(cols=c('white','red'),length=10)</span>
  <span class="co">##</span>
  <span class="co">## or, to create a blue-to-white-to-red gradients with 9 colors (4 blue's, white, 4 red's)</span>
  <span class="co">##</span>
  <span class="co">##   colGradient(cols=c('blue','white','red'),length=9)</span>
  <span class="co">##</span>
  <span class="va">ramp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRamp</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span> <span class="fu">ramp</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,length<span class="op">=</span><span class="va">length</span><span class="op">)</span><span class="op">)</span>, max<span class="op">=</span><span class="va">cmax</span> <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Next, let us perform the actual clustering. While the function <code>heatmap.plus</code> can carry out hierarchical clustering internally, we explicitely call <code>hclust</code> outside the function call to illustrate its use (this will also save computation time should one want to call heatmap.plus multiple times with different color coding or other changes that would not affect the clustering).</p>
<p>Notice that the heatmap color is somewhat saturated. In the module <code>R/Heatmaps.Rmd</code> we present additional visualization functions that do a better job at color-coding the heatmap.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chemicals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu">pData</span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span><span class="op">[</span>,<span class="st">"CHEMICAL"</span><span class="op">]</span><span class="op">)</span>
<span class="va">annot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>CARC<span class="op">=</span><span class="va">dm10</span><span class="op">$</span><span class="va">Carcinogen_liv</span>,
                    CHEM<span class="op">=</span><span class="va">dm10</span><span class="op">$</span><span class="va">CHEMICAL</span>,
                    row.names <span class="op">=</span> <span class="fu">sampleNames</span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span><span class="op">)</span>
<span class="va">annot_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    CARC<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NON-CARC"</span><span class="op">=</span><span class="st">"green"</span>,<span class="st">"CARCINOGEN"</span><span class="op">=</span><span class="st">"pink"</span><span class="op">)</span>,
    CHEM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>chem<span class="op">=</span><span class="va">chemicals</span>,cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">chemicals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tibble/man/enframe.html" class="external-link">deframe</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co">## color gradient for the expression levels (blue=down-regulated; white=neutral; red=up-regulated)</span>
<span class="va">bwrPalette</span> <span class="op">&lt;-</span> <span class="fu">colGradient</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"white"</span>,<span class="st">"red"</span><span class="op">)</span>,length<span class="op">=</span><span class="fl">9</span><span class="op">)</span>

<span class="co">## cluster rows (genes) and columns (samples)</span>
<span class="va">hc_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span> <span class="co"># genes by correlation</span>
<span class="va">hc_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span>           <span class="co"># samples by euclidean distance (default)</span>

<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
         color<span class="op">=</span><span class="va">bwrPalette</span>, 
         annotation_col <span class="op">=</span> <span class="va">annot</span>,
         annotation_colors <span class="op">=</span> <span class="va">annot_col</span>,
         cluster_rows<span class="op">=</span><span class="va">hc_row</span>,
         cluster_cols<span class="op">=</span><span class="va">hc_col</span>,
         show_rownames <span class="op">=</span> <span class="cn">FALSE</span>,
         show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,
         scale <span class="op">=</span> <span class="st">"row"</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/hclust-1.png" width="700"></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## color coding of the samples indicating carcinogenicity status and chemical</span>
<span class="va">chemicals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu">pData</span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span><span class="op">[</span>,<span class="st">"CHEMICAL"</span><span class="op">]</span><span class="op">)</span>
<span class="va">CSC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>CARC<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"green"</span>,<span class="st">"pink"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu">pData</span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Carcinogen_liv"</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="st">"NON-CARC"</span>,<span class="st">"CARCINOGEN"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,
             CHEM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">chemicals</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu">pData</span><span class="op">(</span><span class="va">dm10</span><span class="op">)</span><span class="op">[</span>,<span class="st">"CHEMICAL"</span><span class="op">]</span>,<span class="va">chemicals</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="co">## color gradient for the expression levels (blue=down-regulated; white=neutral; red=up-regulated)</span>
<span class="va">bwrPalette</span> <span class="op">&lt;-</span> <span class="fu">colGradient</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"white"</span>,<span class="st">"red"</span><span class="op">)</span>,length<span class="op">=</span><span class="fl">13</span><span class="op">)</span>

<span class="co">## cluster rows (genes) and columns (samples)</span>
<span class="va">hc.row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span> <span class="co"># genes by correlation</span>
<span class="va">hc.col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span>           <span class="co"># samples by euclidean distance (default)</span>

<span class="co">## draw the heatmap (hide row and col labels since they'd be unreadable)</span>
<span class="fu">heatmap.plus</span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
             Rowv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">hc.row</span><span class="op">)</span>,
             Colv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">hc.col</span><span class="op">)</span>,
             col<span class="op">=</span><span class="va">bwrPalette</span>,
             ColSideColors<span class="op">=</span><span class="va">CSC</span>,
             labCol<span class="op">=</span><span class="cn">NA</span>,labRow<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="optimal-leaf-ordering">Optimal Leaf Ordering<a class="anchor" aria-label="anchor" href="#optimal-leaf-ordering"></a>
</h3>
<p>As discussed in class, hierarchical clustering induces a <em>partial</em> ordering of the dendogram leaves (i.e., of the clustered items), modulo the 'flipping' of any of the sub-trees. However, one can obtain a <em>total</em> ordering by using the leaf-ordering algorithm developed by <a href="http://bioinformatics.oxfordjournals.org/content/19/9/1070" class="external-link">Bar-Joseph et al. (2001)</a>, which minimizes the distance betwees adjacent items in two distinct sub-trees.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cba</span><span class="op">)</span> <span class="co"># load the necessary pacakge</span>

<span class="co">## First, call hclust, then call the leaf-ordering algorithm and re-order the dendrogram</span>

<span class="va">hc_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span>
<span class="va">ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cba/man/order.optimal.html" class="external-link">order.optimal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,merge<span class="op">=</span><span class="va">hc_col</span><span class="op">$</span><span class="va">merge</span><span class="op">)</span>
<span class="va">hc_col</span><span class="op">$</span><span class="va">merge</span> <span class="op">&lt;-</span> <span class="va">ord</span><span class="op">$</span><span class="va">merge</span>
<span class="va">hc_col</span><span class="op">$</span><span class="va">order</span> <span class="op">&lt;-</span> <span class="va">ord</span><span class="op">$</span><span class="va">order</span>

<span class="co">## visualize the results (and compare, visually, to the results w/o optimal leaf ordering above)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
         color<span class="op">=</span><span class="va">bwrPalette</span>, 
         annotation_col <span class="op">=</span> <span class="va">annot</span>,
         annotation_colors <span class="op">=</span> <span class="va">annot_col</span>,
         cluster_rows<span class="op">=</span><span class="va">hc_row</span>,
         cluster_cols<span class="op">=</span><span class="va">hc_col</span>,
         show_rownames <span class="op">=</span> <span class="cn">FALSE</span>,
         show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,
         scale <span class="op">=</span> <span class="st">"row"</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/hcopt-1.png" width="700"></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## since this is a step always worth performing, let's define a simple function that implements the necessary steps</span>
<span class="va">hcopt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">HC</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">method</span> <span class="op">=</span> <span class="st">"ward.D"</span>, <span class="va">members</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">HC</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span> 
    <span class="va">HC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">d</span>,method<span class="op">=</span><span class="va">method</span>,members<span class="op">=</span><span class="va">members</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">ORD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cba/man/order.optimal.html" class="external-link">order.optimal</a></span><span class="op">(</span><span class="va">d</span>,merge<span class="op">=</span><span class="va">HC</span><span class="op">$</span><span class="va">merge</span><span class="op">)</span>
  <span class="va">HC</span><span class="op">$</span><span class="va">merge</span> <span class="op">&lt;-</span> <span class="va">ORD</span><span class="op">$</span><span class="va">merge</span>
  <span class="va">HC</span><span class="op">$</span><span class="va">order</span> <span class="op">&lt;-</span> <span class="va">ORD</span><span class="op">$</span><span class="va">order</span>
  <span class="va">HC</span>
<span class="op">}</span>
<span class="co">## ok, now we can easily use the function in place of hclust</span>
<span class="va">ho_row</span> <span class="op">&lt;-</span> <span class="fu">hcopt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span> <span class="co"># genes by correlation</span>
<span class="va">ho_col</span> <span class="op">&lt;-</span> <span class="fu">hcopt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span>            <span class="co"># samples by euclidean distance (default)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
         color<span class="op">=</span><span class="va">bwrPalette</span>, 
         annotation_col <span class="op">=</span> <span class="va">annot</span>,
         annotation_colors <span class="op">=</span> <span class="va">annot_col</span>,
         cluster_rows<span class="op">=</span><span class="va">ho_row</span>,
         cluster_cols<span class="op">=</span><span class="va">ho_col</span>,
         show_rownames <span class="op">=</span> <span class="cn">FALSE</span>,
         show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,
         scale <span class="op">=</span> <span class="st">"row"</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/hcopt-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="alternative-agglomeration-rules">Alternative Agglomeration Rules<a class="anchor" aria-label="anchor" href="#alternative-agglomeration-rules"></a>
</h3>
<p>In the examples above, we used the <a href="https://en.wikipedia.org/wiki/Ward's_method" class="external-link">Ward method</a> as our agglomeration rule. One of the nice properties of Ward is that it tends to yield well-balanced trees. Let us not look at alternative agglomeration rules.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## complete linkage</span>
<span class="va">ho_row1</span> <span class="op">&lt;-</span> <span class="fu">hcopt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"complete"</span><span class="op">)</span> <span class="co"># genes by correlation</span>
<span class="va">ho_col1</span> <span class="op">&lt;-</span> <span class="fu">hcopt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"complete"</span><span class="op">)</span>           <span class="co"># samples by euclidean distance (default)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
         color<span class="op">=</span><span class="va">bwrPalette</span>, 
         annotation_col <span class="op">=</span> <span class="va">annot</span>,
         annotation_colors <span class="op">=</span> <span class="va">annot_col</span>,
         cluster_rows<span class="op">=</span><span class="va">ho_row1</span>,
         cluster_cols<span class="op">=</span><span class="va">ho_col1</span>,
         show_rownames <span class="op">=</span> <span class="cn">FALSE</span>,
         show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,
         scale <span class="op">=</span> <span class="st">"row"</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/linkage-1.png" width="700"></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## single linkage</span>
<span class="va">ho_row2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"single"</span><span class="op">)</span> <span class="co"># genes by correlation</span>
<span class="va">ho_col2</span> <span class="op">&lt;-</span> <span class="fu">hcopt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"single"</span><span class="op">)</span>            <span class="co"># samples by euclidean distance (default)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
         color<span class="op">=</span><span class="va">bwrPalette</span>, 
         annotation_col <span class="op">=</span> <span class="va">annot</span>,
         annotation_colors <span class="op">=</span> <span class="va">annot_col</span>,
         cluster_rows<span class="op">=</span><span class="va">ho_row2</span>,
         cluster_cols<span class="op">=</span><span class="va">ho_col2</span>,
         show_rownames <span class="op">=</span> <span class="cn">FALSE</span>,
         show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,
         scale <span class="op">=</span> <span class="st">"row"</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/linkage-2.png" width="700"></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## average linkage</span>
<span class="va">ho_row3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"average"</span><span class="op">)</span> <span class="co"># genes by correlation</span>
<span class="va">ho_col3</span> <span class="op">&lt;-</span> <span class="fu">hcopt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"average"</span><span class="op">)</span>            <span class="co"># samples by euclidean distance (default)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span>,
         color<span class="op">=</span><span class="va">bwrPalette</span>, 
         annotation_col <span class="op">=</span> <span class="va">annot</span>,
         annotation_colors <span class="op">=</span> <span class="va">annot_col</span>,
         cluster_rows<span class="op">=</span><span class="va">ho_row3</span>,
         cluster_cols<span class="op">=</span><span class="va">ho_col3</span>,
         show_rownames <span class="op">=</span> <span class="cn">FALSE</span>,
         show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,
         scale <span class="op">=</span> <span class="st">"row"</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="hclust_files/figure-html/linkage-3.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/tetomonti" class="external-link">Stefano Monti</a>, <a href="https://github.com/anfederico" class="external-link">Anthony Federico</a>, <a href="https://github.com/ericreed" class="external-link">Eric Reed</a>, <a href="https://github.com/lia978" class="external-link">Amy Li</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
